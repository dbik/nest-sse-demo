<h1>Testing SSE</h1>

<div class="row">
  <div class="column">
    <table id="cat">
      <thead>
        <tr>
          <th>Cat</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="column">
    <table id="dog">
      <thead>
        <tr>
          <th>Dog</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="column">
    <table id="mouse">
      <thead>
        <tr>
          <th>Mouse</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="column">
    <table id="horse">
      <thead>
        <tr>
          <th>Horse</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="column">
    <table id="elephant">
      <thead>
        <tr>
          <th>Elephant</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="column">
    <table id="dino">
      <thead>
        <tr>
          <th>Dino</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
  const cat = document.getElementById('cat').getElementsByTagName('tbody')[0];
  const dog = document.getElementById('dog').getElementsByTagName('tbody')[0];
  const mouse = document
    .getElementById('mouse')
    .getElementsByTagName('tbody')[0];
  const horse = document
    .getElementById('horse')
    .getElementsByTagName('tbody')[0];
  const elephant = document
    .getElementById('elephant')
    .getElementsByTagName('tbody')[0];
  const dino = document.getElementById('dino').getElementsByTagName('tbody')[0];

  const catSource = new EventSource('/api/cat');
  catSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = cat.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };

  catSource.onopen = ({ data }) => {
    console.log('On open');
    console.log(data);
  };

  catSource.onerror = ({ data }) => {
    console.log('On error');
    console.log(data);
  };

  const dogSource = new EventSource('/api/dog');
  dogSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = dog.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };

  const mouseSource = new EventSource('/api/mouse');
  mouseSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = mouse.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };

  const horseSource = new EventSource('/api/horse');
  horseSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = horse.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };

  const elephantSource = new EventSource('/api/elephant');
  elephantSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = elephant.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };

  const dinoSource = new EventSource('/api/dino');
  dinoSource.onmessage = ({ data }) => {
    console.log('On message');
    const newRow = dino.insertRow();
    const newCell = newRow.insertCell();
    const newText = document.createTextNode(data);
    newCell.appendChild(newText);
  };
</script>

<style>
  * {
    box-sizing: border-box;
  }

  .row {
    display: flex;
    margin-left: -5px;
    margin-right: -5px;
  }

  .column {
    flex: 50%;
    padding: 5px;
  }

  table {
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
    border: 1px solid #ddd;
  }

  th,
  td {
    text-align: left;
    padding: 16px;
  }

  tr:nth-child(even) {
    background-color: #f2f2f2;
  }
</style>
